---
title: '`dplyr` practice lab'
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    css: ../../../styles.css
  pdf_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = 'center')
```

You now have an opportunity to practice the skills you've learnt today in a mini lab task. For this you will be using data which contains income generated by US states from year 2002 to 2015. 

```{r}
library(tidyverse)
```


# Question 1
Load in the data, and have a look at it. How many variables does it have? How many observations? What are the variable names? What type of variables does it have?

```{r}
income_data <- read_csv("data/state_income_data.csv")

names(income_data)

income_data %>% 
  distinct(Index)

income_data %>% 
  filter(is.na(Y2010))

```

My dataset State Income Data has 51 observations across 16 variables.
The variables are an Index, which is the same as the first letter of the State variable, a State variable stored as character and numeric values for each year from 2002 to 2015.
It does not seem to have a lot of missing values at first glance.


# Question 2

Select the columns which contain the information from years `2002` to `2008`. Ensure you keep the `Index` and `State` variables as well.  

```{r}
income_data_2002_2008 <- income_data %>% 
  select(Index, State, Y2002:Y2008)
```

# Question 3

Rename the `Index` column to `first_letter`. *Hint: look up the `rename()` function*. 

```{r}
?rename
income_data_2002_2008 %>% 
  rename(first_letter = Index)
```


<br>


# Question 4

Find the seven states which start with an `A`,`B`, or `C`. 

```{r}
abc_states_income_data_2002_2008 <- income_data_2002_2008 %>% 
  filter(Index %in% c("A", "B", "C"))
```

<br>

# Question 5

Find which of these seven states have the greatest income in 2008.  

```{r}
abc_states_income_data_2002_2008 %>% 
  select(State, Y2008) %>% 
  arrange(desc(Y2008)) %>% 
  head(1)
```

<br>


# Question 6

Calculate the change in income for each state of these seven states (states starting with `A`,`B`, or `C`) between 2002 and 2008. Save the income change in a new column called `income_change`.   

```{r}
abc_states_income_data_2002_2008 <- abc_states_income_data_2002_2008 %>% 
  select(Index, State, Y2002, Y2008) %>% 
  mutate(
    income_change = Y2008 - Y2002
  )
```


<br>



# Question 7

Find which of these seven states income change is greater than 500,000 (i.e. an increase of 500,000 or decrease of 500,000).  
 
```{r}
abc_states_income_data_2002_2008 %>% 
  filter(income_change >= 500000 | income_change <= -500000)
  # filter(abs(income_change) >=500000)
```
<br>


# Question 8  

Calculate the mean and median income change for all seven states.

```{r}
abc_states_income_data_2002_2008 %>% 
  summarise(
    mean_income_change = mean(income_change),
    median_income_change = median(income_change)) 
```

<br>

# Question 9

Go back to the original dataset which contains all states. Write a pipe which selects the `State` and `Y2008` variables, arranges the income from highest to lowest, filters all those states which have a income of greater than 1 million, and then finally chooses the top 10 wealthiest states.  

```{r}
income_data %>% 
  select(State, Y2008) %>% 
  arrange(desc(Y2008)) %>% 
  filter(Y2008 >= 1e6) %>% 
  head(10)
```
```{r}

```

<br>
